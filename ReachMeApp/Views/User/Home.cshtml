@model DomainLayer.Model.User
@using DomainLayer.Dto
@using DomainLayer.Model
@using ServiceLayer.Service.Implementation
@using ReachMeApp.Components
@using Microsoft.AspNetCore.Http;
@using System.Security.Claims;
@using System.IdentityModel.Tokens.Jwt
@inject HttpContextAccessor httpContextAccessor
@inject UserService Service

@{
    ViewData["Title"] = "Home";
    List<Post> myPosts = Service.GetAllFollowingPosts(Model.Id);
    int GetCurrentId()
    {
        var token = httpContextAccessor.HttpContext.Request.Cookies["Jwt"];
        var handler = new JwtSecurityTokenHandler();
        var jwtSecurityToken = handler.ReadJwtToken(token);
        var tokenS = jwtSecurityToken as JwtSecurityToken;
        return int.Parse(tokenS.Claims.First(claim => claim.Type == ClaimTypes.NameIdentifier).Value);
    }
}

@Html.Partial("NavigationBar", new NavigationDto())

<h1>Home</h1>

@(await Html.RenderComponentAsync<PostsList>(RenderMode.ServerPrerendered, new {MyId = GetCurrentId(), UserId = Model.Id, Posts = Service.GetAllFollowingPosts(GetCurrentId()) }))

<script src="_framework/blazor.server.js"></script>